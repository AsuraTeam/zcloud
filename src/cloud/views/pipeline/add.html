<div id="add_post_html" class="modal fade " tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true"
     style="display: none;">
    <div class="modal-dialog " style="width: 58%;">
        <div class="modal-content p-0 b-0 ">
            <div class="panel panel-color panel-default">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <span class="modal-title">添加修改流水线</span>
                </div>
                <form class="cluster-form">
                    <div class="panel-body font-12 " title="">


                        <div class="row top15">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 fw100 control-label">流水线名称<span
                                            class="text-danger">*</span></label>
                                    <div class="col-md-10">
                                        <input type="text" nullmsg="必须填写" value="{{.data.PipelineName}}"
                                               onchange="checkChange('PipelineName')" name="PipelineName"
                                               id="PipelineName"
                                               class="form-control" id="field-13" placeholder="流水线名称 auto-job-1">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row top15">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="col-md-2 fw100 control-label">构建时间<span
                                            class="text-danger">*</span></label>
                                    <div class="col-md-10">
                                        <input type="text" nullmsg="必须填写" value="{{.data.ExecTime}}"
                                               onchange="checkChange('ExecTime')" name="ExecTime"
                                               class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row top15">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="field-2" class="col-md-2 fw100 control-label"></label>
                                    <div class="col-md-10">
                                        <pre class="pre">1、构建镜像<br>2、更新应用</pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row ">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="field-2" class="col-md-2 fw100 control-label"></label>
                                    <div class="col-md-10">
                                        <pre class="pre">构建时间,可按照任务计划时间格式填写!可以手动或自动触发构建</pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row top15" title="集群选择后不可修改">
                            <div class="col-md-12 ">
                                <div class="form-group">
                                    <label for="select-cluster-id"
                                           class="col-md-2 fw100 control-label">所属集群<span
                                            class="text-danger">*</span></label>
                                    <div class="col-md-10">
                                        <select class="selectpicker" name="ClusterName"
                                                onchange="$('#show-cluster-content').show();getResouceData($(this).val(),'select-job-id','/api/ci/job/name','ItemName');getResouceData($(this).val(),'select-app-id','/api/app/name','AppName');"
                                                data-live-search="true" data-style="btn-default"
                                                id="select-cluster-id">
                                            <option>请选择</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row top15">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="field-2" class="col-md-2 fw100 control-label"></label>
                                    <div class="col-md-10">
                                        还没有应用?<a href="/application/app/list">&nbsp;去创建一个应用吧</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="show-cluster-content" style="display: none">
                            <div class="row top15" title="集群选择后不可修改">
                                <div class="col-md-6 top15">
                                    <div class="form-group">
                                        <label for="select-cluster-id"
                                               class="col-md-4 fw100 control-label">应用名称<span
                                                class="text-danger">*</span></label>
                                        <div class="col-md-8">
                                            <select class="selectpicker" name="AppName"
                                                    onchange="getResouceData($('#select-cluster-id').val(),'select-service-id','/api/service/name','ServiceName',$(this).val());"
                                                    data-live-search="true" data-style="btn-default"
                                                    id="select-app-id">
                                                <option value="">请选择</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 top15">
                                    <div class="form-group">
                                        <label for="select-cluster-id"
                                               class="col-md-4 fw100 control-label">服务名称<span
                                                class="text-danger">*</span></label>
                                        <div class="col-md-8">
                                            <select class="selectpicker" name="ServiceName" data-live-search="true"
                                                    data-style="btn-default"
                                                    id="select-service-id">
                                                <option value="">请选择</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row top15">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="field-2" class="col-md-2 fw100 control-label"></label>
                                        <div class="col-md-10">
                                            没有构建任务?<a href="/ci/job/list">&nbsp;去创建一个构建任务吧</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row top15">
                                <div class="col-md-12 top15">
                                    <div class="form-group">
                                        <label for="select-cluster-id"
                                               class="col-md-2 fw100 control-label">构建任务选择<span
                                                class="text-danger">*</span></label>
                                        <div class="col-md-10">
                                            <select class="selectpicker" name="JobName" data-live-search="true"
                                                    data-style="btn-default"
                                                    id="select-job-id">
                                                <option value="">请选择</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row top10 " title="在流水线任务某个失败后,是否继续以后的操作">
                                <div class="col-md-10">
                                    <div class="form-group">
                                        <label class="col-md-3 fw100 control-label top10">FailAction<span
                                                class="text-danger">*</span></label>
                                        <div class="col-md-3 left10" style="margin-left: -40px;">
                                            <div class="radio radio-info left10">
                                                <input id="setSelectFailAction1" value="continue" type="radio"
                                                       name="FailAction">
                                                <label for="setSelectFailAction1" class="fw100 control-label">继续
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-3 ">
                                            <div class="radio radio-warning left10">
                                                <input id="setSelectFailAction2" type="radio" value="pause"
                                                       name="FailAction">
                                                <label for="setSelectFailAction2" class="fw100 control-label">暂停
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row top15">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="field-2" class="col-md-2 fw100 control-label">描述信息</label>
                                    <div class="col-md-10">
                                        <input type="text" value="{{.data.Description}}" name="Description"
                                               class="form-control" id="field-2" placeholder="描述信息">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br>
                    <div class="panel-footer">
                        <button type="button" class="btn btn-default waves-effect" data-dismiss="modal"><i
                                class="fa fa-times"></i>&nbsp;&nbsp;取消
                        </button>
                        <button type="button" onclick="savePipeline('{{.data.PipelineId}}')"
                                class="btn btn-info waves-effect waves-light"><i class="fa fa-save"></i>&nbsp;&nbsp;保存
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="/static/zcloud/registrySelect.js"></script>
<script>
    $("#select-service-id").html("{{.serviceData}}");
    $("#select-app-id").html("{{.appData}}");
    $("#select-job-id").html("{{.jobData}}");
    var id = '{{.data.PipelineId}}';

    if(id != "0"){
        $("#select-cluster-id").html("{{.cluster}}");
    }else {
        $("#select-cluster-id").html("<option>--请选择--</option>{{.cluster}}");
    }
    $('.selectpicker').selectpicker({
        //初始化
        size: 6
    });

    if("{{.jobData}}"){
        $("#show-cluster-content").show();
    }

    var failAction = "{{.data.FailAction}}";
    if(failAction == "continue"){
        $("#setSelectFailAction1").prop("checked","true")
    }else{
        console.log(11)
        $("#setSelectFailAction2").prop("checked","true")
    }


</script>